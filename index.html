<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Reclutamiento Staff</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #5865F2; --success: #2ecc71; --danger: #ed4245; --warning: #f1c40f; --bg: #1e1f22; --card: #2b2d31; --text: #ffffff; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Montserrat', sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 1200px; }
        .hidden { display: none !important; }
        h1 { font-family: 'Press Start 2P', cursive; color: var(--success); font-size: 1rem; text-align: center; margin-bottom: 30px; }
        .card { background: var(--card); padding: 25px; border-radius: 12px; border-top: 5px solid var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        label { display: block; margin: 15px 0 5px; font-weight: 600; font-size: 0.8rem; color: #b5bac1; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #444; background: #1e1f22; color: white; box-sizing: border-box; font-family: inherit; }
        button { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        .btn-send { background: var(--success); width: 100%; margin-top: 20px; color: #000; }
        .btn-admin-gate { background: transparent; color: #555; border: 1px dashed #555; margin: 40px auto; display: block; font-size: 0.7rem; }
        .table-wrapper { overflow-x: auto; margin-top: 20px; background: #18191c; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; min-width: 1100px; }
        th { background: var(--primary); padding: 12px; color: white; }
        td { border-bottom: 1px solid #333; padding: 12px; text-align: center; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; color: #000; display: inline-block; }
        .Pendiente { background: var(--warning); }
        .Aceptado { background: var(--success); }
        .Rechazado { background: var(--danger); color: white; }
        .actions { display: flex; gap: 5px; justify-content: center; }
        .btn-act { padding: 5px 10px; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div id="view-user">
        <h1>[ RECLUTAMIENTO ]</h1>
        <div class="card">
            <label>Nombre de Discord (ej: usuario#0000):</label>
            <input type="text" id="discord_name" placeholder="Tu nombre y tag" required>

            <label>Rango:</label>
            <select id="role" onchange="updateDynamicQ()">
                <option value="ADMIN">ADMINISTRADOR</option>
                <option value="STAFF">STAFF / MODERADOR</option>
                <option value="BUILDER">BUILDER</option>
            </select>

            <div id="dynamic-questions"></div>

            <label>VersiÃ³n de Minecraft:</label>
            <select id="v"><option value="Java">Java</option><option value="Bedrock">Bedrock</option><option value="Ambas">Ambas</option></select>

            <label>Experiencia previa:</label>
            <textarea id="exp" rows="2"></textarea>

            <label>Tiempo diario disponible:</label>
            <input type="text" id="time">

            <label>Comandos conocidos:</label>
            <input type="text" id="cmd">

            <label>Edad:</label>
            <input type="number" id="age">

            <button class="btn-send" onclick="sendData()">Enviar PostulaciÃ³n</button>
        </div>
        <button class="btn-admin-gate" onclick="showLogin()">Acceso Administrador ðŸ”’</button>
    </div>

    <div id="view-login" class="hidden">
        <div class="card" style="max-width: 300px; margin: auto; text-align: center;">
            <label>ContraseÃ±a:</label>
            <input type="password" id="pass">
            <button class="btn-send" onclick="checkLogin()">Entrar</button>
        </div>
    </div>

    <div id="view-admin" class="hidden">
        <h1>PANEL ADMIN</h1>
        <div class="card">
            <button onclick="loadAdminData()" style="background:var(--primary); color:white;">ðŸ”„ Refrescar Lista</button>
            <div class="table-wrapper" id="admin-content">Cargando...</div>
            <button onclick="location.reload()" style="background:#444; margin-top:20px; color:white;">Cerrar SesiÃ³n</button>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwiKkK4NvjfIRVghw6dYgt9WubJjOG_c8iT223_0qfblDTeyc5xRPbhzKxP_YqXerdcdA/exec";
    const CLAVE_CIFRADA = "YWRtaW4yNzI3"; // admin2727

    function updateDynamicQ() {
        const role = document.getElementById('role').value;
        const dyn = document.getElementById('dynamic-questions');
        let q2 = role === 'ADMIN' ? "Â¿Sabes gestionar roles?" : role === 'BUILDER' ? "Â¿Usas WorldEdit?" : "Â¿Sabes moderar el chat?";
        dyn.innerHTML = `<label>2. ${q2}</label><input type="text" id="q2"><label>3. Â¿Por quÃ© quieres entrar?</label><input type="text" id="q3">`;
    }

    async function sendData() {
        const discord = document.getElementById('discord_name').value;
        if(!discord) return alert("Escribe tu nombre de Discord");

        const params = new URLSearchParams({
            action: "create",
            discord: discord,
            role: document.getElementById('role').value,
            v: document.getElementById('v').value,
            q2: document.getElementById('q2').value,
            q3: document.getElementById('q3').value,
            exp: document.getElementById('exp').value,
            time: document.getElementById('time').value,
            cmd: document.getElementById('cmd').value,
            age: document.getElementById('age').value,
            photo: "N/A"
        });

        await fetch(SCRIPT_URL, { method: 'POST', body: params, mode: 'no-cors' });
        alert("âœ… Enviado con Ã©xito");
        location.reload();
    }

    function checkLogin() {
        if(btoa(document.getElementById('pass').value) === CLAVE_CIFRADA) {
            document.getElementById('view-login').classList.add('hidden');
            document.getElementById('view-admin').classList.remove('hidden');
            loadAdminData();
        } else { alert("Clave incorrecta"); }
    }

    async function loadAdminData() {
        const container = document.getElementById('admin-content');
        container.innerHTML = "Obteniendo solicitudes...";
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            let html = "<table><tr><th>Acciones</th><th>Discord</th><th>Rango</th><th>Pregunta 2</th><th>Estado</th></tr>";

            for(let i=1; i < data.length; i++) {
                const userDiscord = data[i][1];
                html += `<tr><td class="actions">
                    <button class="btn-act" style="background:var(--success)" onclick="updateStatus(${i}, 'Aceptado')">âœ”</button>
                    <button class="btn-act" style="background:var(--warning)" onclick="updateStatus(${i}, 'Rechazado')">âœ–</button>
                    <button class="btn-act" style="background:var(--danger); color:white" onclick="deleteRow(${i})">ðŸ—‘</button>
                </td>
                <td style="color:var(--primary); font-weight:bold;">${userDiscord}</td>
                <td>${data[i][2]}</td>
                <td><b>[${userDiscord}]</b> ${data[i][4]}</td>
                <td><span class="status-badge ${data[i][11]}">${data[i][11]}</span></td></tr>`;
            }
            container.innerHTML = html + "</table>";
        } catch(e) { container.innerHTML = "Error al conectar con Google Sheets."; }
    }

    async function updateStatus(row, status) {
        await fetch(SCRIPT_URL, { method: 'POST', body: new URLSearchParams({action: "updateStatus", row: row, status: status}), mode: 'no-cors' });
        loadAdminData();
    }

    async function deleteRow(row) {
        if(!confirm("Â¿Borrar definitivamente?")) return;
        await fetch(SCRIPT_URL, { method: 'POST', body: new URLSearchParams({action: "delete", row: row}), mode: 'no-cors' });
        loadAdminData();
    }

    function showLogin() { document.getElementById('view-user').classList.add('hidden'); document.getElementById('view-login').classList.remove('hidden'); }
    updateDynamicQ();
</script>
</body>
</html>
